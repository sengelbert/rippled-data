#!/bin/bash

loop_count=0
is_running="running"

for (( ; ; ))
do
  ((loop_count=loop_count+1))

  docker_status=$(docker ps -a --format "{{.Names}}\t\t{{.Image}}\t\t{{.State}}" | grep xrpllabsofficial/xrpld:latest)

#  echo -e "\nâœ…âœ…âœ… Docker IP âœ…âœ…âœ…"
  docker_ip=$(docker inspect -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' rippled)

#  echo -e "\nâœ…âœ…âœ… Checking ledger status âœ…âœ…âœ…"
  rippled_ledger=$(docker exec rippled server_info | grep "complete_ledgers")

  echo -e "âœ…âœ…âœ… Status Report âœ…âœ…âœ…"
  echo -e "ğŸ³ Docker Status â© $docker_status"
  echo -e "ğŸ³ Docker IP â© $docker_ip"
  echo -e "ğŸŒŠ Rippled Ledgers â© $rippled_ledger" | xargs

  if [[ "$docker_status" != *"$is_running"* ]]; then
    echo -e "\nDocker Not Running, exiting..."
    break
  fi

  echo -e "\nSleeping 60s. NOTE: Infinite loop (#$loop_count) [hit CTRL+C to stop]\nğŸ˜´"
  sleep 60
done

